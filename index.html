<!DOCTYPE html>
<html>
<head>
    <title>CryptoUltimate</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #1a1a1a;
            --text: #00ff00;
            --border: #00ff0080;
        }
        body {
            font-family: monospace;
            background: var(--bg);
            color: var(--text);
            margin: 2rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        textarea, button, pre {
            background: #000;
            color: var(--text);
            border: 1px solid var(--border);
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        canvas {
            background: #000;
        }
        .hypothesis {
            padding: 1rem;
            border: 1px solid var(--border);
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê CryptoUltimate 10.0</h1>
        <textarea id="input" rows="5" placeholder="Paste ciphertext here..."></textarea>
        <button onclick="startAnalysis()">Analyze</button>
        
        <div class="grid">
            <div id="results"></div>
            <canvas id="chart"></canvas>
        </div>
    </div>

<script>
const CipherMaster = {
    // –ú–µ—Ç–æ–¥ –ö–∞—Å–∏—Å–∫–∏
    kasiski: (text) => {
        const grams = {};
        for (let i = 0; i < text.length - 2; i++) {
            const gram = text.substr(i, 3);
            grams[gram] = grams[gram] || [];
            grams[gram].push(i);
        }
        
        const distances = [];
        for (const gram in grams) {
            if (grams[gram].length > 1) {
                for (let i = 1; i < grams[gram].length; i++) {
                    distances.push(grams[gram][i] - grams[gram][i-1]);
                }
            }
        }
        
        const factors = {};
        distances.forEach(d => {
            for (let i = 2; i <= 20; i++) {
                if (d % i === 0) factors[i] = (factors[i] || 0) + 1;
            }
        });
        
        return Object.entries(factors).sort((a,b) => b[1] - a[1])[0]?.[0] || null;
    },

    // –¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü–∏—è
    transpose: (text, rows) => {
        const cols = Math.ceil(text.length / rows);
        const matrix = Array.from({length: rows}, () => []);
        for (let i = 0; i < text.length; i++) {
            matrix[i % rows].push(text[i]);
        }
        return matrix.flat().join('');
    },

    // –ß–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    frequency: (text) => {
        const freq = {};
        for (const c of text) freq[c] = (freq[c] || 0) + 1;
        return Object.entries(freq).sort((a,b) => b[1] - a[1]);
    },

    // –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    analyze: (text) => {
        const report = [];
        
        // 1. –ú–µ—Ç–æ–¥ –ö–∞—Å–∏—Å–∫–∏
        const keyLength = CipherMaster.kasiski(text);
        if (keyLength) {
            report.push({
                type: 'Vigen√®re',
                keyLength: keyLength,
                confidence: Math.min(100, keyLength * 15)
            });
        }

        // 2. –¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü–∏—è
        for (let rows = 2; rows <= 5; rows++) {
            const transposed = CipherMaster.transpose(text, rows);
            if (/( the | and )/i.test(transposed)) {
                report.push({
                    type: 'Transposition',
                    matrix: `${rows}x${Math.ceil(text.length/rows)}`,
                    preview: transposed.slice(0, 50),
                    confidence: 70
                });
            }
        }

        // 3. –ß–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
        const freq = CipherMaster.frequency(text);
        if (freq[0][1] > text.length * 0.15) {
            report.push({
                type: 'Substitution',
                topChar: freq[0][0],
                confidence: 85
            });
        }

        return report;
    }
};

function startAnalysis() {
    const text = document.getElementById('input').value;
    const results = CipherMaster.analyze(text);
    
    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';
    
    // –†–µ–Ω–¥–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    results.forEach(result => {
        const div = document.createElement('div');
        div.className = 'hypothesis';
        div.innerHTML = `
            <h3>${result.type} (${result.confidence}%)</h3>
            ${result.keyLength ? `Key length: ${result.keyLength}<br>` : ''}
            ${result.matrix ? `Matrix: ${result.matrix}<br>` : ''}
            ${result.preview ? `Preview: ${result.preview}` : ''}
        `;
        resultsDiv.appendChild(div);
    });

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
    const freqData = CipherMaster.frequency(text);
    new Chart(document.getElementById('chart').getContext('2d'), {
        type: 'bar',
        data: {
            labels: freqData.map(d => d[0]),
            datasets: [{
                label: 'Character Frequency',
                data: freqData.map(d => d[1]),
                backgroundColor: '#00ff0050'
            }]
        }
    });
}
</script>
</body>
</html>
